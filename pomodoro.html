<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ… Pomodoro</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --accent:      #ff6b6b;
    --accent-light:#ffb3b3;
    --bg:          #fff5f5;
    --card:        #ffffff;
    --text:        #2d2d2d;
    --muted:       #999999;
    --ring-bg:     #f0f0f0;
    --task-bg:     #fafafa;
    --stat-bg:     #fafafa;
    --btn-icon-bg: #f8f8f8;
    --tab-bg:      #ffffff;
    --radius: 20px;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
    padding: 24px 16px 80px;
    transition: background 0.4s;
  }

  /* â”€â”€ Header row â”€â”€ */
  .header-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    width: 100%;
    max-width: 360px;
    position: relative;
  }

  .app-title {
    font-size: 1.6rem; font-weight: 900;
    color: var(--accent); letter-spacing: -0.5px;
    display: flex; align-items: center; gap: 6px;
    border-bottom: 2px dashed transparent;
    transition: border-color 0.2s, color 0.4s;
    flex: 1; justify-content: center;
  }
  .app-title:focus-within { border-bottom-color: var(--accent-light); }
  #titleInput {
    font: inherit; color: inherit; background: none;
    border: none; outline: none; width: 180px; text-align: center;
    cursor: text;
  }

  /* Palette icon button */
  .palette-btn {
    width: 38px; height: 38px; border-radius: 50%;
    background: var(--card);
    border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.15s, box-shadow 0.15s, background 0.4s;
    flex-shrink: 0;
    color: var(--accent);
  }
  .palette-btn:hover { transform: scale(1.1); box-shadow: 0 4px 14px rgba(0,0,0,0.15); }
  .palette-btn:active { transform: scale(0.95); }

  /* â”€â”€ Tabs â”€â”€ */
  .tabs {
    display: flex; gap: 8px;
    background: var(--tab-bg);
    padding: 6px; border-radius: 50px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    margin-bottom: 24px; transition: background 0.4s;
  }
  .tab {
    padding: 8px 18px; border: none; border-radius: 50px;
    font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.82rem;
    cursor: pointer; background: transparent; color: var(--muted);
    transition: all 0.2s;
  }
  .tab.active { background: var(--accent); color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.15); }

  /* â”€â”€ Timer Card â”€â”€ */
  .timer-card {
    background: var(--card); border-radius: var(--radius);
    padding: 36px 48px; text-align: center;
    box-shadow: 0 4px 30px rgba(0,0,0,0.08);
    width: 100%; max-width: 360px;
    position: relative; overflow: hidden;
    transition: background 0.4s;
  }
  .timer-card::before {
    content:''; position:absolute; top:-60px; right:-60px;
    width:160px; height:160px; border-radius:50%;
    background: color-mix(in srgb, var(--accent) 8%, transparent);
    pointer-events: none;
  }
  .session-label {
    font-size: 0.78rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 2px;
    color: var(--accent); margin-bottom: 12px;
    transition: color 0.4s;
  }

  /* Ring */
  .progress-ring-container { position:relative; display:inline-block; margin-bottom:20px; }
  .progress-ring-container .time-display {
    position:absolute; top:50%; left:50%;
    transform: translate(-50%,-50%);
  }
  svg.ring { transform: rotate(-90deg); }
  .ring-bg  { fill:none; stroke: var(--ring-bg); transition: stroke 0.4s; }
  .ring-fill{ fill:none; stroke: var(--accent); stroke-linecap:round; transition: stroke-dashoffset 1s linear, stroke 0.4s; }
  .time-display {
    font-size: 3rem; font-weight: 900;
    color: var(--text); letter-spacing: -2px;
    line-height:1; font-variant-numeric: tabular-nums; white-space: nowrap;
    transition: color 0.4s;
  }

  /* Controls */
  .controls { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:16px; }
  .btn-main {
    width:64px; height:64px; border-radius:50%;
    background: var(--accent); border:none; color:#fff;
    cursor:pointer; box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    transition: transform 0.15s, background 0.4s;
    display:flex; align-items:center; justify-content:center;
  }
  .btn-main:hover { transform:scale(1.07); }
  .btn-main:active { transform:scale(0.95); }
  .btn-icon {
    width:42px; height:42px; border-radius:50%;
    background: var(--btn-icon-bg); border:none; color: var(--muted);
    cursor:pointer; transition: all 0.15s;
    display:flex; align-items:center; justify-content:center;
  }
  .btn-icon:hover { filter:brightness(0.92); color: var(--text); }

  /* Dots */
  .session-dots { display:flex; gap:6px; justify-content:center; margin-bottom:16px; }
  .dot { width:10px; height:10px; border-radius:50%; background:#ddd; transition: background 0.3s; }
  .dot.done    { background: var(--accent); }
  .dot.current { background: var(--accent-light); }

  /* Badge */
  .current-task-badge {
    border-radius:12px; padding:8px 14px;
    font-size:0.82rem; color: var(--accent);
    font-weight:700; border: 2px dashed var(--accent-light);
    display:flex; align-items:center; justify-content:center; min-height:36px;
    background: color-mix(in srgb, var(--accent) 7%, var(--card));
    transition: color 0.4s, border-color 0.4s, background 0.4s;
    margin-bottom: 20px;
  }

  /* â”€â”€ Panels â”€â”€ */
  .panel {
    background: var(--card); border-radius: var(--radius);
    padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.07);
    width:100%; max-width:360px; margin-top:16px;
    transition: background 0.4s;
  }
  .panel-title {
    font-size:0.8rem; font-weight:800; text-transform:uppercase; letter-spacing:1.5px;
    color: var(--muted); margin-bottom:14px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .toggle-btn { background:none; border:none; font-size:0.8rem; cursor:pointer; color:var(--muted); font-family:'Nunito',sans-serif; font-weight:700; }
  .toggle-btn:hover { color: var(--accent); }

  /* Tasks */
  .task-input-row { display:flex; gap:8px; margin-bottom:12px; }
  .task-input {
    flex:1; border:2px solid var(--ring-bg); border-radius:12px;
    padding:10px 14px; font-family:'Nunito',sans-serif; font-size:0.88rem;
    outline:none; color: var(--text); background: var(--card); transition: border-color 0.2s, background 0.4s;
  }
  .task-input:focus { border-color: var(--accent-light); }
  .btn-add {
    background: var(--accent); color:#fff; border:none; border-radius:12px;
    padding:10px 16px; font-size:1.2rem; cursor:pointer; transition: transform 0.15s, background 0.4s;
  }
  .btn-add:hover { transform:scale(1.05); }
  .task-list { list-style:none; display:flex; flex-direction:column; gap:6px; max-height:200px; overflow-y:auto; }
  .task-item {
    display:flex; align-items:center; gap:10px;
    padding:10px 12px; background: var(--task-bg);
    border-radius:12px; font-size:0.88rem; color: var(--text);
    animation: slideIn 0.2s ease; transition: background 0.4s, color 0.4s;
  }
  @keyframes slideIn { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }
  .task-item.done-task { opacity:0.45; }
  .task-item.done-task .task-text { text-decoration:line-through; }
  .task-check {
    width:20px; height:20px; border-radius:50%; border:2px solid #ccc;
    cursor:pointer; flex-shrink:0; display:flex; align-items:center; justify-content:center;
    font-size:0.7rem; color:#fff; transition:all 0.2s;
  }
  .task-check.checked { background:#51cf66; border-color:#51cf66; }
  .task-text { flex:1; word-break: break-word; padding-right: 4px; }
  .task-del { background:none; border:none; cursor:pointer; color:#ccc; font-size:0.9rem; transition:color 0.2s; padding:2px; flex-shrink:0; }
  .task-del:hover { color: var(--accent); }

  /* Stats */
  .stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .stat-box { background: var(--stat-bg); border-radius:14px; padding:14px; text-align:center; transition: background 0.4s; }
  .stat-value { font-size:1.8rem; font-weight:900; color: var(--accent); line-height:1; transition: color 0.4s; }
  .stat-label { font-size:0.72rem; color: var(--muted); font-weight:600; margin-top:4px; text-transform:uppercase; letter-spacing:0.5px; }

  /* Timer settings */
  .settings-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 0; border-bottom:1px solid var(--ring-bg);
    font-size:0.88rem; color: var(--text); font-weight:600;
    transition: border-color 0.4s, color 0.4s;
    gap: 12px;
  }
  .settings-row:last-child { border-bottom:none; }
  .num-input {
    width:60px; border:2px solid var(--ring-bg); border-radius:10px;
    padding:6px 10px; font-family:'Nunito',sans-serif; font-weight:700;
    font-size:0.9rem; text-align:center; outline:none;
    color: var(--text); background: var(--card); transition: border-color 0.2s, background 0.4s;
    flex-shrink: 0;
  }
  .num-input:focus { border-color: var(--accent-light); }

  /* Toast */
  .toast {
    position:fixed; bottom:24px; left:50%;
    transform:translateX(-50%) translateY(100px);
    background:#2d2d2d; color:#fff;
    padding:12px 24px; border-radius:50px;
    font-size:0.88rem; font-weight:700;
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
    transition:transform 0.3s; z-index:200; white-space:nowrap;
  }
  .toast.show { transform:translateX(-50%) translateY(0); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APPEARANCE MODAL / DRAWER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(4px);
    z-index: 150;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .modal-drawer {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--card);
    border-radius: 24px 24px 0 0;
    padding: 0 20px 40px;
    max-height: 85vh;
    overflow-y: auto;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1), background 0.4s;
    z-index: 160;
    max-width: 480px;
    margin: 0 auto;
  }
  .modal-drawer.open { transform: translateY(0); }

  .drawer-handle {
    width: 40px; height: 4px; border-radius: 2px;
    background: var(--ring-bg); margin: 14px auto 20px;
    transition: background 0.4s;
  }

  .drawer-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--ring-bg);
  }
  .drawer-title {
    font-size: 1.1rem; font-weight: 900;
    color: var(--text); letter-spacing: -0.3px;
    transition: color 0.4s;
  }
  .drawer-close {
    width: 32px; height: 32px; border-radius: 50%;
    background: var(--task-bg); border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: var(--muted); font-size: 1.1rem; font-weight: 700;
    transition: all 0.15s;
  }
  .drawer-close:hover { background: var(--ring-bg); color: var(--text); }

  /* Title section in drawer */
  .drawer-section { margin-bottom: 22px; }
  .drawer-section-label {
    font-size: 0.73rem; font-weight: 800; text-transform: uppercase;
    letter-spacing: 1px; color: var(--muted); margin-bottom: 10px;
    display: block;
  }

  .title-edit-row {
    display: flex; align-items: center; gap: 10px;
    background: var(--task-bg); border-radius: 14px; padding: 10px 14px;
    transition: background 0.4s;
  }
  .title-edit-row span { font-size: 1.3rem; }
  .title-edit-input {
    flex: 1; border: none; outline: none; background: none;
    font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 700;
    color: var(--text); transition: color 0.4s;
  }

  /* Presets */
  .preset-row { display:flex; gap:6px; flex-wrap:wrap; }
  .preset-btn {
    border:none; border-radius:50px; padding:7px 14px;
    font-family:'Nunito',sans-serif; font-size:0.78rem; font-weight:800;
    cursor:pointer; color:#fff; transition: transform 0.15s, box-shadow 0.15s;
    text-shadow: 0 1px 3px rgba(0,0,0,0.25);
  }
  .preset-btn:hover { transform:scale(1.06); box-shadow:0 3px 12px rgba(0,0,0,0.2); }

  /* Color rows */
  .color-list { display: flex; flex-direction: column; gap: 6px; }
  .color-row {
    display:flex; align-items:center;
    background: var(--task-bg); border-radius:12px;
    padding:10px 14px; font-size:0.85rem; font-weight:700; color: var(--text);
    transition: background 0.4s, color 0.4s;
    gap: 10px;
  }
  .color-row-label { flex: 1; }
  .color-swatch {
    width:30px; height:30px; border-radius:9px;
    border:2px solid rgba(0,0,0,0.1); cursor:pointer;
    overflow:hidden; flex-shrink:0; position:relative;
  }
  .swatch-preview { width:100%; height:100%; pointer-events:none; display:block; }
  .color-swatch input[type="color"] {
    position:absolute; top:-4px; left:-4px;
    width:140%; height:140%; border:none; outline:none;
    cursor:pointer; opacity:0;
  }

  .reset-btn {
    width:100%; border:2px solid var(--ring-bg); background:none;
    border-radius:12px; padding:11px 14px; margin-top: 12px;
    font-family:'Nunito',sans-serif; font-size:0.85rem; font-weight:700;
    color: var(--muted); cursor:pointer; transition:all 0.2s;
  }
  .reset-btn:hover { border-color: var(--accent); color: var(--accent); }
</style>
</head>
<body>

<!-- Header -->
<div class="header-row">
  <h1 class="app-title">
    <span>ğŸ…</span>
    <input id="titleInput" type="text" value="Pomodoro" maxlength="24"
           title="Click to rename" onchange="saveTitle()" onblur="saveTitle()">
  </h1>
  <!-- Palette icon -->
  <button class="palette-btn" onclick="openModal()" title="Customize appearance">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="13.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/>
      <circle cx="17.5" cy="10.5" r="1.5" fill="currentColor" stroke="none"/>
      <circle cx="8.5"  cy="7.5"  r="1.5" fill="currentColor" stroke="none"/>
      <circle cx="6.5"  cy="12.5" r="1.5" fill="currentColor" stroke="none"/>
      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/>
    </svg>
  </button>
</div>

<!-- Mode Tabs -->
<div class="tabs">
  <button class="tab active" onclick="switchMode('pomodoro')">Focus</button>
  <button class="tab" onclick="switchMode('short')">Short Break</button>
  <button class="tab" onclick="switchMode('long')">Long Break</button>
</div>

<!-- Timer Card -->
<div class="timer-card">
  <div class="session-label" id="sessionLabel">Focus Session</div>
  <div class="progress-ring-container">
    <svg class="ring" width="180" height="180" viewBox="0 0 180 180">
      <circle class="ring-bg"   cx="90" cy="90" r="82" stroke-width="10"/>
      <circle class="ring-fill" cx="90" cy="90" r="82" stroke-width="10"
              id="ringFill" stroke-dasharray="515.22" stroke-dashoffset="0"/>
    </svg>
    <div class="time-display" id="timeDisplay">25:00</div>
  </div>
  <div class="current-task-badge" id="currentTaskBadge">No task selected</div>
  <div class="controls">
    <button class="btn-icon" onclick="skipBack()" title="Restart">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3.51"/>
      </svg>
    </button>
    <button class="btn-main" onclick="toggleTimer()">
      <svg id="playIcon"  width="24" height="24" viewBox="0 0 24 24" fill="white"><polygon points="5,3 19,12 5,21"/></svg>
      <svg id="pauseIcon" width="24" height="24" viewBox="0 0 24 24" fill="white" style="display:none">
        <rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/>
      </svg>
    </button>
    <button class="btn-icon" onclick="skipForward()" title="Skip to next session">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="5 4 15 12 5 20"/><line x1="19" y1="5" x2="19" y2="19"/>
      </svg>
    </button>
  </div>
  <div class="session-dots" id="sessionDots"></div>
</div>

<!-- Tasks -->
<div class="panel">
  <div class="panel-title">ğŸ“ Tasks <button class="toggle-btn" onclick="clearDoneTasks()">Clear done</button></div>
  <div class="task-input-row">
    <input class="task-input" id="taskInput" placeholder="What to focus on?" maxlength="60"
           onkeydown="if(event.key==='Enter') addTask()">
    <button class="btn-add" onclick="addTask()">+</button>
  </div>
  <ul class="task-list" id="taskList"></ul>
</div>

<!-- Stats -->
<div class="panel">
  <div class="panel-title">ğŸ“Š Today's Stats</div>
  <div class="stats-grid">
    <div class="stat-box"><div class="stat-value" id="statPomodoros">0</div><div class="stat-label">Pomodoros</div></div>
    <div class="stat-box"><div class="stat-value" id="statMinutes">0</div><div class="stat-label">Min focused</div></div>
    <div class="stat-box"><div class="stat-value" id="statTasks">0</div><div class="stat-label">Tasks done</div></div>
    <div class="stat-box"><div class="stat-value" id="statStreak">0</div><div class="stat-label">Day streak ğŸ”¥</div></div>
  </div>
</div>

<!-- Timer Settings -->
<div class="panel">
  <div class="panel-title">âš™ï¸ Timer Settings</div>
  <div class="settings-row"><span>Focus duration (min)</span><input class="num-input" id="setPomodoro" type="number" min="1" max="60" value="25" onchange="applySettings()"></div>
  <div class="settings-row"><span>Short break (min)</span><input class="num-input" id="setShort" type="number" min="1" max="30" value="5" onchange="applySettings()"></div>
  <div class="settings-row"><span>Long break (min)</span><input class="num-input" id="setLong" type="number" min="1" max="60" value="15" onchange="applySettings()"></div>
  <div class="settings-row"><span>Sessions before long break</span><input class="num-input" id="setSessions" type="number" min="2" max="8" value="4" onchange="applySettings()"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APPEARANCE MODAL DRAWER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
<div class="modal-drawer" id="modalDrawer">
  <div class="drawer-handle"></div>
  <div class="drawer-header">
    <span class="drawer-title">ğŸ¨ Appearance</span>
    <button class="drawer-close" onclick="closeModal()">âœ•</button>
  </div>

  <!-- App Title -->
  <div class="drawer-section">
    <span class="drawer-section-label">App Title</span>
    <div class="title-edit-row">
      <span>ğŸ…</span>
      <input class="title-edit-input" id="titleInputModal" type="text" value="Pomodoro"
             maxlength="24" placeholder="App nameâ€¦"
             oninput="syncTitle(this.value)" onchange="saveTitle()">
    </div>
  </div>

  <!-- Quick Themes -->
  <div class="drawer-section">
    <span class="drawer-section-label">Quick Themes</span>
    <div class="preset-row" id="presetRow"></div>
  </div>

  <!-- Custom Colors -->
  <div class="drawer-section">
    <span class="drawer-section-label">Custom Colors</span>
    <div class="color-list" id="colorGrid"></div>
    <button class="reset-btn" onclick="resetColors()">â†º Reset to defaults</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal() {
  document.getElementById('modalOverlay').classList.add('open');
  document.getElementById('modalDrawer').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  document.getElementById('modalDrawer').classList.remove('open');
  document.body.style.overflow = '';
}
// Prevent overlay click from going through drawer
document.getElementById('modalDrawer').addEventListener('click', e => e.stopPropagation());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COLOR SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COLOR_VARS = [
  { id:'accent',       label:'Accent / Primary', cssVar:'--accent' },
  { id:'accent-light', label:'Accent Light',     cssVar:'--accent-light' },
  { id:'bg',           label:'Background',       cssVar:'--bg' },
  { id:'card',         label:'Cards',            cssVar:'--card' },
  { id:'text',         label:'Text',             cssVar:'--text' },
  { id:'muted',        label:'Muted Text',       cssVar:'--muted' },
  { id:'ring-bg',      label:'Ring Track',       cssVar:'--ring-bg' },
  { id:'task-bg',      label:'Task Items',       cssVar:'--task-bg' },
  { id:'stat-bg',      label:'Stat Boxes',       cssVar:'--stat-bg' },
  { id:'btn-icon-bg',  label:'Icon Buttons',     cssVar:'--btn-icon-bg' },
  { id:'tab-bg',       label:'Tab Bar',          cssVar:'--tab-bg' },
];

const DEFAULTS = {
  'accent':      '#ff6b6b',
  'accent-light':'#ffb3b3',
  'bg':          '#fff5f5',
  'card':        '#ffffff',
  'text':        '#2d2d2d',
  'muted':       '#999999',
  'ring-bg':     '#f0f0f0',
  'task-bg':     '#fafafa',
  'stat-bg':     '#fafafa',
  'btn-icon-bg': '#f8f8f8',
  'tab-bg':      '#ffffff',
};

const PRESETS = [
  { name:'ğŸ… Tomato',   btnBg:'#ff6b6b', colors:{ accent:'#ff6b6b','accent-light':'#ffb3b3',bg:'#fff5f5',card:'#ffffff',text:'#2d2d2d',muted:'#999999','ring-bg':'#f0f0f0','task-bg':'#fafafa','stat-bg':'#fafafa','btn-icon-bg':'#f8f8f8','tab-bg':'#ffffff' } },
  { name:'ğŸŒŠ Ocean',    btnBg:'#4dabf7', colors:{ accent:'#4dabf7','accent-light':'#a5d8ff',bg:'#f0f8ff',card:'#ffffff',text:'#1a365d',muted:'#7bafd4','ring-bg':'#dbeafe','task-bg':'#f0f8ff','stat-bg':'#e8f4fd','btn-icon-bg':'#dbeafe','tab-bg':'#ffffff' } },
  { name:'ğŸŒ¿ Forest',   btnBg:'#40c057', colors:{ accent:'#40c057','accent-light':'#b2f2bb',bg:'#f0fff4',card:'#ffffff',text:'#1a3a2a',muted:'#74b98a','ring-bg':'#d3f9d8','task-bg':'#f0fff4','stat-bg':'#e6f9ec','btn-icon-bg':'#d3f9d8','tab-bg':'#ffffff' } },
  { name:'ğŸŒ¸ Blossom',  btnBg:'#f783ac', colors:{ accent:'#f783ac','accent-light':'#fcc2d7',bg:'#fff0f6',card:'#ffffff',text:'#3a1a2e',muted:'#c47a9a','ring-bg':'#fce4ec','task-bg':'#fff0f6','stat-bg':'#fce4ec','btn-icon-bg':'#fce4ec','tab-bg':'#ffffff' } },
  { name:'ğŸŒ™ Midnight', btnBg:'#5c7cfa', colors:{ accent:'#5c7cfa','accent-light':'#91a7ff',bg:'#0f1117',card:'#1a1d2e',text:'#e8eaf6',muted:'#6c7293','ring-bg':'#252840','task-bg':'#1e2133','stat-bg':'#1e2133','btn-icon-bg':'#252840','tab-bg':'#1a1d2e' } },
  { name:'â˜€ï¸ Sunny',    btnBg:'#f59f00', colors:{ accent:'#f59f00','accent-light':'#ffe066',bg:'#fffdf0',card:'#ffffff',text:'#3a2e00',muted:'#b8a000','ring-bg':'#fff9c4','task-bg':'#fffdf0','stat-bg':'#fff9c4','btn-icon-bg':'#fff9c4','tab-bg':'#ffffff' } },
  { name:'ğŸ‡ Grape',    btnBg:'#9775fa', colors:{ accent:'#9775fa','accent-light':'#d0bfff',bg:'#faf8ff',card:'#ffffff',text:'#2a1a3e',muted:'#9b8ab8','ring-bg':'#ede9fe','task-bg':'#faf8ff','stat-bg':'#ede9fe','btn-icon-bg':'#ede9fe','tab-bg':'#ffffff' } },
  { name:'ğŸ–¤ Slate',    btnBg:'#495057', colors:{ accent:'#495057','accent-light':'#adb5bd',bg:'#f8f9fa',card:'#ffffff',text:'#212529',muted:'#868e96','ring-bg':'#e9ecef','task-bg':'#f8f9fa','stat-bg':'#f1f3f5','btn-icon-bg':'#e9ecef','tab-bg':'#ffffff' } },
];

let customColors = JSON.parse(localStorage.getItem('pomo_colors') || 'null') || {...DEFAULTS};

function applyColors() {
  const root = document.documentElement;
  COLOR_VARS.forEach(({id, cssVar}) => {
    const val = customColors[id] || DEFAULTS[id];
    root.style.setProperty(cssVar, val);
    if (id === 'bg') document.body.style.background = val;
    const preview = document.getElementById('swatch-preview-' + id);
    const picker  = document.getElementById('picker-' + id);
    if (preview) preview.style.background = val;
    if (picker)  picker.value = val;
  });
  localStorage.setItem('pomo_colors', JSON.stringify(customColors));
}

function buildColorGrid() {
  const grid = document.getElementById('colorGrid');
  grid.innerHTML = '';
  COLOR_VARS.forEach(({id, label}) => {
    const row = document.createElement('div');
    row.className = 'color-row';
    row.innerHTML = `
      <span class="color-row-label">${label}</span>
      <div class="color-swatch">
        <div class="swatch-preview" id="swatch-preview-${id}" style="background:${customColors[id]||DEFAULTS[id]}"></div>
        <input type="color" id="picker-${id}" value="${customColors[id]||DEFAULTS[id]}"
               oninput="onColorChange('${id}',this.value)">
      </div>`;
    grid.appendChild(row);
  });
}

function buildPresets() {
  const row = document.getElementById('presetRow');
  row.innerHTML = '';
  PRESETS.forEach(preset => {
    const btn = document.createElement('button');
    btn.className = 'preset-btn';
    btn.style.background = preset.btnBg;
    btn.textContent = preset.name;
    btn.onclick = () => { customColors = {...preset.colors}; applyColors(); showToast(preset.name + ' applied!'); };
    row.appendChild(btn);
  });
}

function onColorChange(id, val) {
  customColors[id] = val;
  applyColors();
}

function resetColors() {
  customColors = {...DEFAULTS};
  applyColors();
  showToast('â†º Colors reset to default');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TITLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function syncTitle(val) {
  // Keep both inputs in sync
  document.getElementById('titleInput').value = val;
  document.getElementById('titleInputModal').value = val;
}
function saveTitle() {
  const val = (document.getElementById('titleInputModal').value || document.getElementById('titleInput').value).trim() || 'Pomodoro';
  document.getElementById('titleInput').value = val;
  document.getElementById('titleInputModal').value = val;
  localStorage.setItem('pomo_title', val);
}
function loadTitle() {
  const saved = localStorage.getItem('pomo_title');
  if (saved) {
    document.getElementById('titleInput').value = saved;
    document.getElementById('titleInputModal').value = saved;
  }
}
// Sync main title input too
document.getElementById('titleInput').addEventListener('input', e => {
  document.getElementById('titleInputModal').value = e.target.value;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let mode = 'pomodoro', running = false, interval = null;
let timeLeft = 25*60, totalTime = 25*60;
let completedSessions = 0, activeTaskId = null;
let settings = { pomodoro:25, short:5, long:15, sessionsBeforeLong:4 };

let tasks = JSON.parse(localStorage.getItem('pomo_tasks') || '[]');
let stats = JSON.parse(localStorage.getItem('pomo_stats') || JSON.stringify({pomodoros:0,minutes:0,tasks:0,streak:0,lastDate:''}));

function checkStreak() {
  const today = new Date().toDateString();
  const yesterday = new Date(Date.now()-86400000).toDateString();
  if (stats.lastDate === today) return;
  stats.streak = stats.lastDate === yesterday ? stats.streak+1 : 1;
  stats.lastDate = today; saveStats();
}
checkStreak();

function saveStats() {
  localStorage.setItem('pomo_stats', JSON.stringify(stats));
  ['Pomodoros','Minutes','Tasks','Streak'].forEach((k,i) => {
    document.getElementById('stat'+k).textContent = [stats.pomodoros,stats.minutes,stats.tasks,stats.streak][i];
  });
}
saveStats();

function saveTasks() { localStorage.setItem('pomo_tasks', JSON.stringify(tasks)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const modeLabels = { pomodoro:'Focus Session', short:'Short Break â˜•', long:'Long Break ğŸŒ¿' };

function switchMode(m) {
  if (running) stopTimer();
  mode = m;
  document.querySelectorAll('.tab').forEach((t,i) => t.classList.toggle('active', ['pomodoro','short','long'][i]===m));
  timeLeft = totalTime = settings[m]*60;
  document.getElementById('sessionLabel').textContent = modeLabels[m];
  updateDisplay(); renderSessionDots();
}

function applySettings() {
  settings.pomodoro = parseInt(document.getElementById('setPomodoro').value)||25;
  settings.short    = parseInt(document.getElementById('setShort').value)||5;
  settings.long     = parseInt(document.getElementById('setLong').value)||15;
  settings.sessionsBeforeLong = parseInt(document.getElementById('setSessions').value)||4;
  switchMode(mode);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTimer() { running ? stopTimer() : startTimer(); }

function setPlayIcon(playing) {
  document.getElementById('playIcon').style.display  = playing ? 'none'  : 'block';
  document.getElementById('pauseIcon').style.display = playing ? 'block' : 'none';
}

function startTimer() { running=true; setPlayIcon(true); interval=setInterval(tick,1000); }
function stopTimer()  { running=false; clearInterval(interval); setPlayIcon(false); }

function tick() {
  if (--timeLeft <= 0) { timeLeft=0; updateDisplay(); stopTimer(); onTimerEnd(); }
  else updateDisplay();
}

function skipBack()    { stopTimer(); timeLeft=totalTime; updateDisplay(); }
function skipForward() {
  stopTimer();
  const next = mode==='pomodoro'
    ? (completedSessions % settings.sessionsBeforeLong === settings.sessionsBeforeLong-1 ? 'long' : 'short')
    : 'pomodoro';
  switchMode(next);
}

function onTimerEnd() {
  if (mode === 'pomodoro') {
    completedSessions++;
    stats.pomodoros++; stats.minutes += settings.pomodoro; stats.lastDate = new Date().toDateString();
    saveStats(); renderSessionDots();
    showToast('ğŸ… Pomodoro complete! Great work!');
    if (Notification.permission==='granted') new Notification('ğŸ… Done!', {body:'Time for a break!'});
    const next = completedSessions % settings.sessionsBeforeLong === 0 ? 'long' : 'short';
    setTimeout(() => switchMode(next), 800);
  } else {
    showToast('Break over! Back to focus ğŸ’ª');
    setTimeout(() => switchMode('pomodoro'), 800);
  }
}

function updateDisplay() {
  const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s = (timeLeft%60).toString().padStart(2,'0');
  document.getElementById('timeDisplay').textContent = `${m}:${s}`;
  document.title = `${m}:${s} â€” ${document.getElementById('titleInput').value}`;
  document.getElementById('ringFill').style.strokeDashoffset = 515.22 * (1 - timeLeft/totalTime);
}

function renderSessionDots() {
  const c = document.getElementById('sessionDots'), n = settings.sessionsBeforeLong;
  c.innerHTML = '';
  const cur = completedSessions % n;
  for (let i=0; i<n; i++) {
    const d = document.createElement('div');
    d.className = 'dot' + (i<cur ? ' done' : (i===cur && mode==='pomodoro' ? ' current' : ''));
    c.appendChild(d);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TASKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTasks() {
  const list = document.getElementById('taskList');
  list.innerHTML = '';
  tasks.forEach(task => {
    const li = document.createElement('li');
    li.className = 'task-item' + (task.done ? ' done-task' : '');
    if (task.id === activeTaskId) li.style.outline = '2px solid var(--accent-light)';
    li.innerHTML = `
      <div class="task-check ${task.done?'checked':''}" onclick="toggleTask('${task.id}')">${task.done?'âœ“':''}</div>
      <span class="task-text" onclick="selectTask('${task.id}')" style="cursor:pointer">${task.text}</span>
      <button class="task-del" onclick="deleteTask('${task.id}')">âœ•</button>`;
    list.appendChild(li);
  });
  updateCurrentBadge();
}

function addTask() {
  const inp = document.getElementById('taskInput');
  const text = inp.value.trim(); if (!text) return;
  const task = {id:Date.now().toString(), text, done:false};
  tasks.push(task); if (!activeTaskId) activeTaskId = task.id;
  saveTasks(); renderTasks(); inp.value='';
}

function toggleTask(id) {
  const t = tasks.find(t=>t.id===id); if (!t) return;
  t.done = !t.done;
  if (t.done) {
    stats.tasks++; stats.lastDate=new Date().toDateString(); saveStats(); showToast('âœ… Task complete!');
    if (activeTaskId===id) { const n=tasks.find(t=>!t.done&&t.id!==id); activeTaskId=n?n.id:null; }
  }
  saveTasks(); renderTasks();
}

function selectTask(id) { activeTaskId = activeTaskId===id ? null : id; renderTasks(); }

function deleteTask(id) {
  tasks=tasks.filter(t=>t.id!==id);
  if (activeTaskId===id) { const n=tasks.find(t=>!t.done); activeTaskId=n?n.id:null; }
  saveTasks(); renderTasks();
}

function clearDoneTasks() { tasks=tasks.filter(t=>!t.done); saveTasks(); renderTasks(); }

function updateCurrentBadge() {
  const t = activeTaskId ? tasks.find(t=>t.id===activeTaskId) : null;
  document.getElementById('currentTaskBadge').textContent = t ? `ğŸ¯ ${t.text}` : 'No task selected';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimeout;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => el.classList.remove('show'), 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildPresets();
buildColorGrid();
applyColors();
loadTitle();
renderSessionDots();
renderTasks();
updateDisplay();

if ('Notification' in window && Notification.permission==='default') Notification.requestPermission();
</script>
</body>
</html>
